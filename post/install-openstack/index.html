<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="Aaron&#39;s Notes">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="https://www.cloudnotes.cc/media/cover.jpg">
    <meta property="twitter:image" content="https://www.cloudnotes.cc/media/cover.jpg" />
    

    
    <meta name="title" content="OpenStack部署笔记" />
    <meta property="og:title" content="OpenStack部署笔记" />
    <meta property="twitter:title" content="OpenStack部署笔记" />
    

    
    <meta name="description" content="人到中年，容易忘事，做点笔记方便以后查阅">
    <meta property="og:description" content="人到中年，容易忘事，做点笔记方便以后查阅" />
    <meta property="twitter:description" content="人到中年，容易忘事，做点笔记方便以后查阅" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="cloud computing, distributed system, container, lazy shell tools">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>OpenStack部署笔记-Aaron&#39;s Notes</title>

    <link rel="canonical" href="/post/install-openstack/">

    <link rel="stylesheet" href="/css/iDisqus.min.css"/>
	
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    
    <link rel="stylesheet" href="/css/syntax.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">

    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    
    
    <script src="/js/jquery.min.js"></script>
    
    
    <script src="/js/bootstrap.min.js"></script>
    
    
    <script src="/js/hux-blog.min.js"></script>
	
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/docco.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
</head>


<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Aaron&#39;s Notes</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    <li>
                        <a href="/categories/non-tech">Non-Tech</a>
                    </li>
                    
                    
		    
                        <li><a href="/book/2019-booklist/">BOOK</a></li>
                    
                        <li><a href="/about/me/">ABOUT</a></li>
                    

                    
		    <li>
                        <a href="/search">SEARCH <img src="/img/search.png" height="15" style="cursor: pointer;" alt="Search"></a>
		    </li>
                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('/media/cover.jpg')
    }
</style>
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/openstack" title="OpenStack">
                            OpenStack
                        </a>
                        
                        <a class="tag" href="/tags/hands-on" title="hands-on">
                            hands-on
                        </a>
                        
                    </div>
                    <h1>OpenStack部署笔记</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
			Posted by 
			
			         &#34;Aaron&#34;
			 
			on 
			Sunday, May 5, 2019
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                
                <header>
                    <h2>TOC</h2>
                </header>
                <nav id="TableOfContents">
<ul>
<li><a href="#topology">Topology</a></li>
<li><a href="#controller-node">controller node</a>
<ul>
<li><a href="#env-prepare">env prepare</a></li>
<li><a href="#keystone">keystone</a></li>
<li><a href="#glance">glance</a></li>
<li><a href="#nova">nova</a></li>
<li><a href="#neutron">neutron</a></li>
<li><a href="#dashboard">dashboard</a></li>
<li><a href="#heat">heat</a></li>
<li><a href="#mistral-issue-solving">mistral (issue solving)</a></li>
<li><a href="#barbican">barbican</a></li>
<li><a href="#tacker">tacker</a></li>
</ul></li>
<li><a href="#compute-node">compute node</a>
<ul>
<li><a href="#env-prepare-1">env prepare</a></li>
<li><a href="#nova-1">nova</a></li>
<li><a href="#neutron-1">neutron</a></li>
</ul></li>
</ul>
</nav>
                
                

<h1 id="topology">Topology</h1>

<p>单控制节点加单计算节点（节点的说法不太准确，节点的角色应以上面部署的服务来定义，这里控制节点指主要业务如nova，neutron等服务部署的节点，方便起见沿用下来）。基于Pike版本，Queen，Rocky等版本在Neutron服务的某些端口号和部分配置文件上有区别，已分别表示出来。mistral部署出现了一些问题，配置待解决后贴出。</p>

<h1 id="controller-node">controller node</h1>

<h2 id="env-prepare">env prepare</h2>

<p>configure nic in /etc/network/interfaces
manually add controller name in /etc/hosts, comment the 127.0.1.1</p>

<p><strong>package</strong></p>

<pre><code class="language-shell"># apt install software-properties-common
# add-apt-repository cloud-archive:pike
# apt update &amp;&amp; apt dist-upgrade
# apt install python-openstackclient
</code></pre>

<p><strong>sql</strong></p>

<pre><code class="language-shell"># apt install mariadb-server python-pymysql
# cat &lt;&lt; EOF &gt; /etc/mysql/mariadb.conf.d/99-openstack.cnf
[mysqld]
bind-address = 0.0.0.0
default-storage-engine = innodb
innodb_file_per_table = on
max_connections = 4096
collation-server = utf8_general_ci
character-set-server = utf8
EOF

# service mysql restart
# mysql_secure_installation
# cat &lt;&lt; EOF &gt; dbsetup.sql
DELETE FROM mysql.user WHERE User='';
DELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');
DROP DATABASE IF EXISTS test;
DELETE FROM mysql.db WHERE Db='test' OR Db='test\\_%';
FLUSH PRIVILEGES;
EOF

# mysql -u root &lt; dbsetup.sql
</code></pre>

<p><strong>message queue</strong></p>

<pre><code class="language-shell"># apt install rabbitmq-server
# rabbitmqctl add_user openstack xxDCG
# rabbitmqctl set_permissions openstack &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;
</code></pre>

<p><strong>memcached</strong></p>

<pre><code class="language-shell"># apt install memcached python-memcache
# sed -iold &quot;s/-l.*/-l 0.0.0.0/&quot; /etc/memcached.conf
# sed -iold &quot;s/-m.*/-m 1024/&quot; /etc/memcached.conf
# service memcached restart
</code></pre>

<p><strong>etcd</strong>
for queen version</p>

<pre><code class="language-shell"># apt install etcd
# cat &lt;&lt; EOF &gt; /etc/default/etcd 
ETCD_NAME=&quot;dcgController&quot;
ETCD_DATA_DIR=&quot;/var/lib/etcd&quot;
ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;
ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster-01&quot;
ETCD_INITIAL_CLUSTER=&quot;dcgController=http://172.16.182.61:2380&quot;
ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;http://172.16.182.61:2380&quot;
ETCD_ADVERTISE_CLIENT_URLS=&quot;http://172.16.182.61:2379&quot;
ETCD_LISTEN_PEER_URLS=&quot;http://0.0.0.0:2380&quot;
ETCD_LISTEN_CLIENT_URLS=&quot;http://172.16.182.61:2379&quot;
EOF
</code></pre>

<p>for pike version</p>

<pre><code class="language-shell"># groupadd --system etcd
# useradd --home-dir &quot;/var/lib/etcd&quot; --system --shell /bin/false -g etcd etcd
# mkdir -p /etc/etcd
# chown etcd:etcd /etc/etcd
# mkdir -p /var/lib/etcd
# chown etcd:etcd /var/lib/etcd
# ETCD_VER=v3.3.5
# rm -rf /tmp/etcd &amp;&amp; mkdir -p /tmp/etcd
# apt install curl
# curl -L https://github.com/etcd-io/etcd/releases/download/${ETCD_VER}/etcd-${ETCD_VER}-linux-amd64.tar.gz -o /tmp/etcd-${ETCD_VER}-linux-amd64.tar.gz
/*abandon*/
# curl -L https://github.com/coreos/etcd/releases/download/${ETCD_VER}/etcd-${ETCD_VER}-linux-amd64.tar.gz -o /tmp/etcd-${ETCD_VER}-linux-amd64.tar.gz
# tar xzvf /tmp/etcd-${ETCD_VER}-linux-amd64.tar.gz -C /tmp/etcd --strip-components=1
# cp /tmp/etcd/etcd /usr/bin/etcd
# cp /tmp/etcd/etcdctl /usr/bin/etcdctl
# cat &lt;&lt; EOF &gt; /etc/etcd/etcd.conf.yml
name: dcg-bj-01
data-dir: /var/lib/etcd
initial-cluster-state: 'new'
initial-cluster-token: 'etcd-cluster-01'
initial-cluster: dcg-bj-01=http://172.16.182.50:2380
initial-advertise-peer-urls: http://172.16.182.50:2380
advertise-client-urls: http://172.16.182.50:2379
listen-peer-urls: http://0.0.0.0:2380
listen-client-urls: http://172.16.182.50:2379
EOF

# cat &lt;&lt; EOF &gt; /lib/systemd/system/etcd.service
[Unit]
After=network.target
Description=etcd - highly-available key value store

[Service]
LimitNOFILE=65536
Restart=on-failure
Type=notify
ExecStart=/usr/bin/etcd --config-file /etc/etcd/etcd.conf.yml
User=etcd

[Install]
WantedBy=multi-user.target
EOF
</code></pre>

<p><strong>reload service</strong></p>

<pre><code class="language-shell">systemctl enable etcd
systemctl start etcd
</code></pre>

<h2 id="keystone">keystone</h2>

<pre><code class="language-shell"># cat &lt;&lt;EOF &gt; keystone.sql
DROP DATABASE IF EXISTS keystone;
CREATE DATABASE keystone;
GRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'localhost' IDENTIFIED BY 'xxDCG';
GRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'%' IDENTIFIED BY 'xxDCG';
EOF

# mysql -u root &lt; keystone.sql
# apt install keystone apache2 libapache2-mod-wsgi
# cat &lt;&lt;EOF &gt; /etc/keystone/keystone.conf
[database]
connection = mysql+pymysql://keystone:xxDCG@dcg-bj-01.bj.xx.com/keystone
[token]
provider = fernet
EOF

# su -s /bin/sh -c &quot;keystone-manage db_sync&quot; keystone
# keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone
# keystone-manage credential_setup --keystone-user keystone --keystone-group keystone
# keystone-manage bootstrap --bootstrap-password xxDCG \
  --bootstrap-admin-url http://dcg-bj-01.bj.xx.com:35357/v3/ \
  --bootstrap-internal-url http://dcg-bj-01.bj.xx.com:5000/v3/ \
  --bootstrap-public-url http://dcg-bj-01.bj.xx.com:5000/v3/ \
  --bootstrap-region-id RegionOne
  
# edit /etc/apache2/apache2.conf
ServerName dcg-bj-01.bj.xx.com
# service apache2 restart
# touch adminrc
# cat &lt;&lt;EOF &gt; ./adminrc
export OS_USERNAME=admin
export OS_PASSWORD=xxDCG
export OS_PROJECT_NAME=admin
export OS_USER_DOMAIN_NAME=default
export OS_PROJECT_DOMAIN_NAME=default
export OS_AUTH_URL=http://dcg-bj-01.bj.xx.com:35357/v3
export OS_IDENTITY_API_VERSION=3
EOF
# source adminrc
# openstack project create --domain default --description &quot;Service Project&quot; service
</code></pre>

<h2 id="glance">glance</h2>

<pre><code class="language-shell"># cat &lt;&lt;EOF &gt; glance.sql
DROP DATABASE IF EXISTS glance;
CREATE DATABASE glance;
GRANT ALL PRIVILEGES ON glance.* TO 'glance'@'localhost' IDENTIFIED BY 'xxDCG';
GRANT ALL PRIVILEGES ON glance.* TO 'glance'@'%' IDENTIFIED BY 'xxDCG';
EOF
# mysql -u root &lt; glance.sql

#openstack user create --domain default --password xxDCG glance
#openstack role add --project service --user glance admin
#openstack service create --name glance --description &quot;OpenStack Image&quot; image
#openstack endpoint create --region RegionOne image public http://dcg-bj-01.bj.xx.com:9292
#openstack endpoint create --region RegionOne image internal http://dcg-bj-01.bj.xx.com:9292
#openstack endpoint create --region RegionOne image admin http://dcg-bj-01.bj.xx.com:9292

# apt install -y glance
# cat &lt;&lt;EOF &gt; /etc/glance/glance-api.conf
[database]
connection = mysql+pymysql://glance:xxDCG@dcg-bj-01.bj.xx.com/glance

[keystone_authtoken]
auth_uri = http://dcg-bj-01.bj.xx.com:5000
auth_url = http://dcg-bj-01.bj.xx.com:35357
memcached_servers = dcg-bj-01.bj.xx.com:11211
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = glance
password = xxDCG

[paste_deploy]
flavor = keystone

[glance_store]
stores = file,http
default_store = file
filesystem_store_datadir = /var/lib/glance/images/
EOF

# cat &lt;&lt;EOF &gt; /etc/glance/glance-registry.conf
[database]
connection = mysql+pymysql://glance:xxDCG@dcg-bj-01.bj.xx.com/glance

[keystone_authtoken]
auth_uri = http://dcg-bj-01.bj.xx.com:5000
auth_url = http://dcg-bj-01.bj.xx.com:35357
memcached_servers = dcg-bj-01.bj.xx.com:11211
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = glance
password = xxDCG

[paste_deploy]
flavor = keystone
EOF

# su -s /bin/sh -c &quot;glance-manage db_sync&quot; glance
# service glance-registry restart
# service glance-api restart

# mkdir /tmp/images
# cd /tmp/images/
# wget http://download.cirros-cloud.net/0.3.5/cirros-0.3.5-x86_64-disk.img
# openstack image create &quot;cirros&quot; \
  --file cirros-0.3.5-x86_64-disk.img \
  --disk-format qcow2 --container-format bare \
  --public
# openstack image list
</code></pre>

<h2 id="nova">nova</h2>

<pre><code class="language-shell"># cat &lt;&lt;EOF &gt; ~/nova.sql
DROP DATABASE IF EXISTS nova;
CREATE DATABASE nova;
GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'localhost' IDENTIFIED BY 'xxDCG';
GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'%' IDENTIFIED BY 'xxDCG';

DROP DATABASE IF EXISTS nova_api;
CREATE DATABASE nova_api;
GRANT ALL PRIVILEGES ON nova_api.* TO 'nova'@'localhost' IDENTIFIED BY 'xxDCG';
GRANT ALL PRIVILEGES ON nova_api.* TO 'nova'@'%' IDENTIFIED BY 'xxDCG';

DROP DATABASE IF EXISTS nova_cell0;
CREATE DATABASE nova_cell0;
GRANT ALL PRIVILEGES ON nova_cell0.* TO 'nova'@'localhost' IDENTIFIED BY 'xxDCG';
GRANT ALL PRIVILEGES ON nova_cell0.* TO 'nova'@'%' IDENTIFIED BY 'xxDCG';
EOF
# mysql -u root &lt; ~/nova.sql

# openstack user create --domain default --password xxDCG nova
# openstack role add --project service --user nova admin
# openstack service create --name nova --description &quot;OpenStack Compute&quot; compute
# openstack endpoint create --region RegionOne compute public http://dcg-bj-01.bj.xx.com:8774/v2.1
# openstack endpoint create --region RegionOne compute internal http://dcg-bj-01.bj.xx.com:8774/v2.1
# openstack endpoint create --region RegionOne compute admin http://dcg-bj-01.bj.xx.com:8774/v2.1

# openstack user create --domain default --password xxDCG placement
# openstack role add --project service --user placement admin
# openstack service create --name placement --description &quot;Placement API&quot; placement
# openstack endpoint create --region RegionOne placement public http://dcg-bj-01.bj.xx.com:8778
# openstack endpoint create --region RegionOne placement internal http://dcg-bj-01.bj.xx.com:8778
# openstack endpoint create --region RegionOne placement admin http://dcg-bj-01.bj.xx.com:8778

# apt install -y nova-api nova-conductor nova-consoleauth \
  nova-novncproxy nova-scheduler nova-placement-api nova-compute

# cat &lt;&lt;EOF &gt; /etc/nova/nova.conf
[DEFAULT]
instances_path= /var/lib/nova/instances
transport_url = rabbit://openstack:xxDCG@dcg-bj-01.bj.xx.com
use_neutron = True
firewall_driver = nova.virt.firewall.NoopFirewallDriver
enabled_apis = osapi_compute,metadata

my_ip = $(ifconfig eno01 | awk '/ inet / {print $2}' | sed &quot;s/^addr://&quot;)
#host = $(hostname -s)
osapi_compute_workers = 10
#metadata_host = $my_ip
metadata_workers = 5

# Name Templates
instance_name_template = instance-%08x
multi_instance_display_name_template = %(name)s-%(count)s
snapshot_name_template = snapshot-%s

# Compute Driver
compute_driver = libvirt.LibvirtDriver

# Timeouts
instance_build_timeout = 120
instance_delete_timeout = 300
reboot_timeout = 60
reclaim_instance_interval = 60
resize_confirm_window = 600

# VM Allocation Ratios
cpu_allocation_ratio = 4.0
disk_allocation_ratio = 1.0
ram_allocation_ratio = 1.0
reserved_huge_pages = node:1,size:1GB,count:5
reserved_huge_pages = node:0,size:1GB,count:5

# Other Options
reserved_host_cpus = 0
allow_resize_to_same_host = True
compute_monitors = cpu.virt_driver, numa_mem_bw.virt_driver
max_concurrent_builds = 20
max_local_block_devices = 500
osapi_compute_unique_server_name_scope = global
os_region_name = RegionOne
instance_usage_audit_period = hour
# my_block_storage_ip = \$my_ip
vcpu_pin_set = 13-21,35-43,57-65,79-87

[api_database]
connection = mysql+pymysql://nova:xxDCG@dcg-bj-01.bj.xx.com/nova_api

[database]
connection = mysql+pymysql://nova:xxDCG@dcg-bj-01.bj.xx.com/nova  

[api]
auth_strategy = keystone

[keystone_authtoken]
auth_uri = http://dcg-bj-01.bj.xx.com:5000
auth_url = http://dcg-bj-01.bj.xx.com:35357
memcached_servers = dcg-bj-01.bj.xx.com:11211
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = nova
password = xxDCG

[neutron]
url = http://dcg-bj-01.bj.xx.com:9696
auth_url = http://dcg-bj-01.bj.xx.com:35357
auth_type = password
project_domain_name = default
user_domain_name = default
region_name = RegionOne
project_name = service
username = neutron
password = xxDCG

# For Metadata Service
service_metadata_proxy = True
metadata_proxy_shared_secret = xxDCG

[vnc]
enabled = true
vncserver_listen = 0.0.0.0
vncserver_proxyclient_address = \$my_ip
novncproxy_base_url = http://dcg-bj-01.bj.xx.com:6080/vnc_auto.html

[glance]
api_servers = http://dcg-bj-01.bj.xx.com:9292

[oslo_concurrency]
lock_path = /var/lib/nova/tmp

[placement]
os_region_name = RegionOne
project_domain_name = Default
project_name = service
auth_type = password
user_domain_name = Default
auth_url = http://dcg-bj-01.bj.xx.com:35357/v3
username = placement
password = xxDCG

[libvirt]
virt_type = kvm 

[scheduler]
discover_hosts_in_cells_interval = 300

[cells]
enable = False
EOF

# su -s /bin/sh -c &quot;nova-manage api_db sync&quot; nova
# su -s /bin/sh -c &quot;nova-manage cell_v2 map_cell0&quot; nova
# su -s /bin/sh -c &quot;nova-manage cell_v2 create_cell --name=cell1 --verbose&quot; nova
# su -s /bin/sh -c &quot;nova-manage db sync&quot; nova
# nova-manage cell_v2 list_cells
# service nova-api restart
# service nova-consoleauth restart
# service nova-scheduler restart
# service nova-conductor restart
# service nova-novncproxy restart
# service nova-compute restart
# openstack compute service list --service nova-compute
# su -s /bin/sh -c &quot;nova-manage cell_v2 discover_hosts --verbose&quot; nova
</code></pre>

<p><strong>flavor list create</strong></p>

<pre><code class="language-shell">**pinned**
openstack flavor create test.tiny       --disk 60 --public --vcpus 2 --ram 2048
openstack flavor create small.pinned    --disk 100 --public --property hw:cpu_policy=dedicated --property hw:cpu_thread_policy=prefer  --property hw:mem_page_size=1048576 --property hw:numa_nodes=1 --vcpus 2 --ram 4096
openstack flavor create medium.pinned   --disk 100 --public --property hw:cpu_policy=dedicated --property hw:cpu_thread_policy=prefer  --property hw:mem_page_size=1048576 --property hw:numa_nodes=1 --vcpus 4 --ram 8192
openstack flavor create large.pinned    --disk 100 --public --property hw:cpu_policy=dedicated --property hw:cpu_thread_policy=prefer  --property hw:mem_page_size=1048576 --property hw:numa_nodes=1 --vcpus 8 --ram 16384

**shared**
openstack flavor create small.shared    --disk 100 --public --property hw:cpu_policy=shared                                            --property hw:mem_page_size=1048576 --property hw:numa_nodes=1 --vcpus 2 --ram 4096
openstack flavor create medium.shared   --disk 100 --public --property hw:cpu_policy=shared                                            --property hw:mem_page_size=1048576 --property hw:numa_nodes=1 --vcpus 4 --ram 8192
openstack flavor create large.shared    --disk 100 --public --property hw:cpu_policy=shared                                            --property hw:mem_page_size=1048576 --property hw:numa_nodes=1 --vcpus 8 --ram 16384

**dedicate**
openstack flavor create small.physical  --disk 100 --public --property hw:cpu_policy=dedicated --property hw:cpu_thread_policy=isolate --property hw:mem_page_size=1048576 --property hw:numa_nodes=1 --vcpus 2 --ram 4096
openstack flavor create medium.physical --disk 100 --public --property hw:cpu_policy=dedicated --property hw:cpu_thread_policy=isolate --property hw:mem_page_size=1048576 --property hw:numa_nodes=1 --vcpus 4 --ram 8192
openstack flavor create large.physical  --disk 100 --public --property hw:cpu_policy=dedicated --property hw:cpu_thread_policy=isolate --property hw:mem_page_size=1048576 --property hw:numa_nodes=1 --vcpus 8 --ram 16384
</code></pre>

<h2 id="neutron">neutron</h2>

<p><strong>for linux bridge</strong></p>

<pre><code class="language-shell"># apt install neutron-server neutron-plugin-ml2 \
  neutron-linuxbridge-agent neutron-l3-agent neutron-dhcp-agent \
  neutron-metadata-agent
</code></pre>

<p><strong>for ovs, python-networking-ovs-dpdk?</strong></p>

<pre><code class="language-shell"># apt install neutron-server neutron-plugin-ml2 \
  neutron-openvswitch-agent neutron-l3-agent neutron-dhcp-agent \
  neutron-metadata-agent
</code></pre>

<p><strong>common part</strong></p>

<pre><code class="language-shell"># cat &lt;&lt;EOF &gt; ~/neutron.sql
DROP DATABASE IF EXISTS neutron;
CREATE DATABASE neutron;
GRANT ALL PRIVILEGES ON neutron.* TO 'neutron'@'localhost' IDENTIFIED BY 'xxDCG';
GRANT ALL PRIVILEGES ON neutron.* TO 'neutron'@'%' IDENTIFIED BY 'xxDCG';
EOF
# mysql -u root &lt; ~/neutron.sql

# openstack user create --domain default --password xxDCG neutron
# openstack role add --project service --user neutron admin
# openstack service create --name neutron --description &quot;OpenStack Networking&quot; network

# openstack endpoint create --region RegionOne network public http://dcg-bj-01.bj.xx.com:9696
# openstack endpoint create --region RegionOne network internal http://dcg-bj-01.bj.xx.com:9696
# openstack endpoint create --region RegionOne network admin http://dcg-bj-01.bj.xx.com:9696

# cat &lt;&lt;EOF &gt; /etc/neutron/neutron.conf
[DEFAULT]
core_plugin = ml2
#service_plugins = router,metering,flow_classifier,sfc,qos
service_plugins = router
allow_overlapping_ips = true
auth_strategy = keystone
notify_nova_on_port_status_changes = True
notify_nova_on_port_data_changes = True
api_workers = 10
router_distributed = false
transport_url = rabbit://openstack:xxDCG@dcg-bj-01.bj.xx.com

[agent]
root_helper = sudo /usr/bin/neutron-rootwrap /etc/neutron/rootwrap.conf

[database]
connection = mysql+pymysql://neutron:xxDCG@dcg-bj-01.bj.xx.com/neutron

[keystone_authtoken]
auth_uri = http://dcg-bj-01.bj.xx.com:5000
auth_url = http://dcg-bj-01.bj.xx.com:35357
memcached_servers = dcg-bj-01.bj.xx.com:11211
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = neutron
password = xxDCG

[nova]
auth_url = http://dcg-bj-01.bj.xx.com:35357
auth_type = password
project_domain_name = default
user_domain_name = default
region_name = RegionOne
project_name = service
username = nova
password = xxDCG
EOF
</code></pre>

<p><strong>for linux bridge</strong></p>

<pre><code class="language-shell"># cat &lt;&lt;EOF &gt; /etc/neutron/plugins/ml2/ml2_conf.ini
[ml2]
type_drivers = flat,vlan,vxlan
tenant_network_types = vlan
mechanism_drivers = linuxbridge,l2population
extension_drivers = port_security
overlay_ip_version = 4

[ml2_type_flat]
flat_networks = external

[ml2_type_vlan]
network_vlan_ranges = provider:3601:3999
[ovs]
bridge_mappings = provider:br-vlan

[ml2_type_vxlan]
vni_ranges = 1:1000

[securitygroup]
enable_ipset = true
EOF
</code></pre>

<p><strong>for ovs</strong></p>

<pre><code class="language-shell"># cat &lt;&lt;EOF &gt; /etc/neutron/plugins/ml2/ml2_conf.ini
[ml2]
type_drivers = flat,vlan,vxlan
tenant_network_types = vlan
mechanism_drivers = openvswitch,l2population
extension_drivers = port_security
overlay_ip_version = 4
path_mtu = 9000

[ml2_type_flat]
flat_networks = external

[ml2_type_vlan]
network_vlan_ranges = provider:3601:3999

[ml2_type_vxlan]
vni_ranges = 1:1000

[ml2_sriov]
#supported_pci_vendor_devs = 8086:154c
#agent_required = True

[securitygroup]
enable_ipset = true
EOF
</code></pre>

<p><strong>for linux bridge</strong></p>

<pre><code class="language-shell"># cat &lt;&lt;EOF &gt; /etc/neutron/plugins/ml2/linuxbridge_agent.ini
[linux_bridge]
physical_interface_mappings = provider:ens192,external:ens160

[vxlan]
enable_vxlan = false
local_ip = dcg-bj-01.bj.xx.com
l2_population = true

[securitygroup]
enable_security_group = true
firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver
EOF
</code></pre>

<p><strong>for ovs</strong></p>

<pre><code class="language-shell">cat &lt;&lt;EOF &gt; /etc/neutron/plugins/ml2/openvswitch_agent.ini
[DEFAULT]
debug = False
# log_config_append = /etc/neutron/logging.conf

[securitygroup]
enable_security_group = True

[ovs]
bridge_mappings = external:br-ex,provider:br-vlan
datapath_type = netdev
vhostuser_socket_dir = /var/run/openvswitch
ovsdb_interface = vsctl

[agent]
#extensions = sfc,qos
enable_distributed_routing = True
EOF
</code></pre>

<p><strong>for linux bridge</strong></p>

<pre><code class="language-shell"># cat &lt;&lt;EOF &gt; /etc/neutron/l3_agent.ini
[DEFAULT]
interface_driver = linuxbridge
EOF
</code></pre>

<p><strong>for ovs</strong></p>

<pre><code class="language-shell"># cat &lt;&lt;EOF &gt; /etc/neutron/l3_agent.ini
[DEFAULT]
debug = False
interface_driver = neutron.agent.linux.interface.OVSInterfaceDriver
use_namespaces = True
agent_mode = dvr_snat
EOF
</code></pre>

<p><strong>for linux bridge</strong></p>

<pre><code class="language-shell"># cat &lt;&lt;EOF &gt; /etc/neutron/dhcp_agent.ini
[DEFAULT]
interface_driver = linuxbridge
dhcp_driver = neutron.agent.linux.dhcp.Dnsmasq
enable_isolated_metadata = true
EOF
</code></pre>

<p><strong>for ovs</strong></p>

<pre><code class="language-shell"># cat &lt;&lt;EOF &gt; /etc/neutron/dhcp_agent.ini
[DEFAULT]
debug = False
interface_driver = neutron.agent.linux.interface.OVSInterfaceDriver
dhcp_driver = neutron.agent.linux.dhcp.Dnsmasq
enable_isolated_metadata = True
EOF

# cat &lt;&lt;EOF &gt; /etc/neutron/metadata_agent.ini
[DEFAULT]
verbose = True
nova_metadata_host = dcg-bj-01.bj.xx.com
metadata_proxy_shared_secret = xxDCG
EOF
</code></pre>

<pre><code class="language-shell"># su -s /bin/sh -c &quot;neutron-db-manage --config-file /etc/neutron/neutron.conf \
  --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head&quot; neutron

# service nova-api restart
# service nova-compute restart
# service neutron-server restart
# service neutron-linuxbridge-agent restart
# service neutron-dhcp-agent restart
# service neutron-metadata-agent restart
# service neutron-l3-agent restart
# service neutron-openvswitch-agent restart
</code></pre>

<p><strong>for ovs, extra configuration</strong></p>

<pre><code class="language-shell"># ovs-vsctl add-br br-ex
# ovs-vsctl add-port br-ex eno1
# ovs-vsctl add-br br-vlan
# ovs-vsctl add-port br-vlan eno3
</code></pre>

<p><strong>create interface for floating ip</strong></p>

<pre><code class="language-shell"># openstack network create \
    --share \
    --external \
    --provider-network-type flat \
    --provider-physical-network external \
    external-flat

# openstack subnet create \
    --subnet-range 172.16.182.0/24 \
    --dhcp \
    --gateway 172.16.182.1 \
    --network external-flat \
    --allocation-pool start=172.16.182.240,end=172.16.182.249 \
    --dns-nameserver 10.248.2.5 \
    external-flat-sub
</code></pre>

<p><strong>create provider network</strong></p>

<pre><code class="language-shell"># openstack network create \
    --share \
	--provider-network-type vlan \
	--provider-physical-network provider \
	provider-vlan

# openstack subnet create \
    --subnet-range 196.128.1.0/24 \
    --gateway 196.128.1.1 \
    --network provider-vlan \
    --allocation-pool start=196.128.1.11,end=196.128.1.250 \
    provider-vlan-sub
</code></pre>

<h2 id="dashboard">dashboard</h2>

<pre><code class="language-shell"># apt install openstack-dashboard
# edit /etc/openstack-dashboard/local_settings.py
OPENSTACK_HOST = &quot;dcg-bj-01.bj.xx.com&quot;
OPENSTACK_KEYSTONE_URL = &quot;http://%s:5000/v3&quot; % OPENSTACK_HOST
OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = &quot;Default&quot;
OPENSTACK_KEYSTONE_DEFAULT_ROLE = &quot;admin&quot;
ALLOWED_HOSTS = ['*', ]

SESSION_ENGINE = 'django.contrib.sessions.backends.cache'
CACHES = {
    'default': {
         'BACKEND': 'django.core.cache.backends.memcached.MemcachedCache',
         'LOCATION': 'dcg-bj-01.bj.xx.com:11211',
    }
}

OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True

OPENSTACK_API_VERSIONS = {
    &quot;identity&quot;: 3,
    &quot;image&quot;: 2,
    &quot;volume&quot;: 2,
	&quot;compute&quot;: 2,
}

OPENSTACK_NEUTRON_NETWORK = {
    'enable_router': True,
    'enable_quotas': True,
    'enable_ipv6': False,
    'enable_distributed_router': False,
    'enable_ha_router': False,
    'enable_lb': False,
    'enable_firewall': False,
    'enable_vpn': False,
    'enable_fip_topology_check': True,
    'segmentation_id_range': {
        'vlan': [3601, 3999],
    },	
	'default_dns_nameservers': [&quot;10.248.2.5&quot;],
	'supported_vnic_types': ['*'],
}

TIME_ZONE = &quot;Asia/Hong_Kong&quot;
</code></pre>

<p><strong>add line below to /etc/apache2/conf-available/openstack-dashboard.conf</strong>
WSGIApplicationGroup %{GLOBAL}</p>

<pre><code class="language-shell"># service apache2 reload
</code></pre>

<h2 id="heat">heat</h2>

<pre><code class="language-shell"># cat &lt;&lt;EOF &gt; ~/heat.sql
DROP DATABASE IF EXISTS heat;
CREATE DATABASE heat;
GRANT ALL PRIVILEGES ON heat.* TO 'heat'@'localhost' IDENTIFIED BY 'xxDCG';
GRANT ALL PRIVILEGES ON heat.* TO 'heat'@'%' IDENTIFIED BY 'xxDCG';
EOF
# mysql -u root &lt; ~/heat.sql
# openstack user create --domain default --password xxDCG heat
# openstack role add --project service --user heat admin
# openstack role add --project default --user heat admin
# openstack service create --name heat --description &quot;Orchestration&quot; orchestration
# openstack service create --name heat-cfn --description &quot;Orchestration&quot; cloudformation
# openstack endpoint create --region RegionOne orchestration public http://dcg-bj-01.bj.xx.com:8004/v1/%\(tenant_id\)s
# openstack endpoint create --region RegionOne orchestration internal http://dcg-bj-01.bj.xx.com:8004/v1/%\(tenant_id\)s
# openstack endpoint create --region RegionOne orchestration admin http://dcg-bj-01.bj.xx.com:8004/v1/%\(tenant_id\)s
# openstack endpoint create --region RegionOne cloudformation public http://dcg-bj-01.bj.xx.com:8000/v1
# openstack endpoint create --region RegionOne cloudformation internal http://dcg-bj-01.bj.xx.com:8000/v1
# openstack endpoint create --region RegionOne cloudformation admin http://dcg-bj-01.bj.xx.com:8000/v1

# openstack domain create --description &quot;Stack projects and users&quot; heat
# openstack user create --domain heat --password xxDCG heat_domain_admin
# openstack role add --domain heat --user-domain heat --user heat_domain_admin admin
# openstack role create heat_stack_owner
# openstack role add --project service --user heat heat_stack_owner
# openstack role add --project default --user heat heat_stack_owner


# apt-get install -y heat-api heat-api-cfn heat-engine
# edit /etc/heat/heat.conf
[DEFAULT]
heat_metadata_server_url = http://dcg-bj-01.bj.xx.com:8000
heat_waitcondition_server_url = http://dcg-bj-01.bj.xx.com:8000/v1/waitcondition
stack_domain_admin = heat_domain_admin
stack_domain_admin_password = xxDCG
stack_user_domain_name = heat
transport_url = rabbit://openstack:xxDCG@dcg-bj-01.bj.xx.com

[database]
connection = mysql+pymysql://heat:xxDCG@dcg-bj-01.bj.xx.com/heat

[keystone_authtoken]
auth_uri = http://dcg-bj-01.bj.xx.com:5000
auth_url = http://dcg-bj-01.bj.xx.com:35357
memcached_servers = dcg-bj-01.bj.xx.com:11211
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = heat
password = xxDCG

[trustee]
auth_type = password
auth_url = http://dcg-bj-01.bj.xx.com:35357
username = heat
password = xxDCG
user_domain_name = default

[clients_keystone]
auth_uri = http://dcg-bj-01.bj.xx.com:35357

[ec2authtoken]
auth_uri = http://dcg-bj-01.bj.xx.com:5000/v3

# su -s /bin/sh -c &quot;heat-manage db_sync&quot; heat
# service heat-api restart
# service heat-api-cfn restart
# service heat-engine restart

# openstack orchestration service list
+--------------+-------------+--------------------------------------+--------------+--------+----------------------------+--------+
| Hostname     | Binary      | Engine ID                            | Host         | Topic  | Updated At                 | Status |
+--------------+-------------+--------------------------------------+--------------+--------+----------------------------+--------+
| dcg-bj-01.bj.xx.com | heat-engine | 707b44ad-00db-44cb-b7d9-926c92f009ba | dcg-bj-01.bj.xx.com | engine | 2018-07-19T02:10:31.000000 | up     |
| dcg-bj-01.bj.xx.com | heat-engine | 31f96f54-dae0-4ece-986b-6e4c16c78487 | dcg-bj-01.bj.xx.com | engine | 2018-07-19T02:10:31.000000 | up     |
| dcg-bj-01.bj.xx.com | heat-engine | e3e1ec28-e127-4ab0-8df8-beee62c58932 | dcg-bj-01.bj.xx.com | engine | 2018-07-19T02:10:31.000000 | up     |
| dcg-bj-01.bj.xx.com | heat-engine | a1d4ca4b-88d8-43f8-936e-d60af257546e | dcg-bj-01.bj.xx.com | engine | 2018-07-19T02:10:31.000000 | up     |
| dcg-bj-01.bj.xx.com | heat-engine | 1cdf7d16-5687-4467-8a3d-85b36758979c | dcg-bj-01.bj.xx.com | engine | 2018-07-19T02:10:31.000000 | up     |
| dcg-bj-01.bj.xx.com | heat-engine | 1020a1a1-29ab-4e17-9c5c-e8e2d0d7560b | dcg-bj-01.bj.xx.com | engine | 2018-07-19T02:10:31.000000 | up     |
| dcg-bj-01.bj.xx.com | heat-engine | 96a58be5-f5bc-4ff1-a9b8-7077f45e1577 | dcg-bj-01.bj.xx.com | engine | 2018-07-19T02:10:31.000000 | up     |
| dcg-bj-01.bj.xx.com | heat-engine | 930d42c4-96eb-4443-afe0-8b6d936b4dce | dcg-bj-01.bj.xx.com | engine | 2018-07-19T02:10:31.000000 | up     |
+--------------+-------------+--------------------------------------+--------------+--------+----------------------------+--------+
</code></pre>

<h2 id="mistral-issue-solving">mistral (issue solving)</h2>

<h2 id="barbican">barbican</h2>

<pre><code class="language-shell"># cat &lt;&lt;EOF &gt; ~/barbican.sql
DROP DATABASE IF EXISTS barbican;
CREATE DATABASE barbican;
GRANT ALL PRIVILEGES ON barbican.* TO 'barbican'@'localhost' IDENTIFIED BY 'xxDCG';
GRANT ALL PRIVILEGES ON barbican.* TO 'barbican'@'%' IDENTIFIED BY 'xxDCG';
EOF
# mysql -u root &lt; ~/barbican.sql

# export BARBICAN=dcg-bj-01.bj.xx.com
# openstack user create --domain default --password xxDCG barbican
# openstack role add --project service --user barbican admin
# openstack service create --name barbican --description &quot;OpenStack Key Manager&quot; key-manager
# openstack endpoint create --region RegionOne key-manager public http://$BARBICAN:9311
# openstack endpoint create --region RegionOne key-manager internal http://$BARBICAN:9311
# openstack endpoint create --region RegionOne key-manager admin http://$BARBICAN:9311

# apt-get install barbican-api barbican-keystone-listener barbican-worker
# cat &lt;&lt;EOF &gt; /etc/barbican/barbican.conf
[DEFAULT]
sql_connection = mysql+pymysql://barbican:xxDCG@dcg-bj-01.bj.xx.com/barbican
transport_url = rabbit://openstack:xxDCG@dcg-bj-01.bj.xx.com

[keystone_authtoken]
auth_uri = http://dcg-bj-01.bj.xx.com:5000
auth_url = http://dcg-bj-01.bj.xx.com:35357
memcached_servers = dcg-bj-01.bj.xx.com:11211
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = barbican
password = xxDCG

[secretstore]
enabled_secretstore_plugins = store_crypto

[crypto]
enabled_crypto_plugins = simple_crypto

[simple_crypto_plugin]
kek = $(uuidgen | sed 's/\-//g' | base64)
EOF

# su -s /bin/sh -c &quot;barbican-manage db upgrade&quot; barbican
</code></pre>

<h2 id="tacker">tacker</h2>

<pre><code class="language-shell"># cat &lt;&lt;EOF &gt; tacker.sql
DROP DATABASE IF EXISTS tacker;
CREATE DATABASE tacker;
GRANT ALL PRIVILEGES ON tacker.* TO 'tacker'@'localhost' IDENTIFIED BY 'xxDCG';
GRANT ALL PRIVILEGES ON tacker.* TO 'tacker'@'%' IDENTIFIED BY 'xxDCG';
EOF
# mysql -u root &lt; tacker.sql

# export TACKER=dcg-bj-01.bj.xx.com
# openstack user create --domain default --password xxDCG tacker
# openstack role add --project service --user tacker admin
# openstack service create --name tacker --description &quot;OpenStack NFV Orchestration&quot; nfv-orchestration
# openstack endpoint create --region RegionOne nfv-orchestration public http://$TACKER:9890
# openstack endpoint create --region RegionOne nfv-orchestration internal http://$TACKER:9890
# openstack endpoint create --region RegionOne nfv-orchestration admin http://$TACKER:9890

# git clone https://github.com/openstack/tacker
# cd tacker
# git checkout stable/pike
# pip install -r requirements.txt
# python setup.py install
# mkdir /var/log/tacker
# mkdir /etc/tacker
# tools/generate_config_file_sample.sh
# cat &lt;&lt;EOF &gt; ~/tacker/etc/tacker/tacker.conf
[DEFAULT]
auth_strategy = keystone
policy_file = /usr/local/etc/tacker/policy.json
debug = True
use_syslog = False
bind_host = dcg-bj-01.bj.xx.com
bind_port = 9890
service_plugins = nfvo,vnfm
state_path = /var/lib/tacker

[nfvo_vim]
vim_drivers = openstack

[keystone_authtoken]
memcached_servers = 11211
region_name = RegionOne
auth_type = password
project_domain_name = default
user_domain_name = default
username = admin
project_name = service
password = xxDCG
auth_url = http://dcg-bj-01.bj.xx.com:35357
auth_uri = http://dcg-bj-01.bj.xx.com:5000

[agent]
root_helper = sudo /usr/local/bin/tacker-rootwrap /usr/local/etc/tacker/rootwrap.conf

[database]
connection = mysql+pymysql://tacker:xxDCG@dcg-bj-01.bj.xx.com:3306/tacker?charset=utf8

[tacker]
monitor_driver = ping,http_ping
EOF

# cp ~/tacker/etc/tacker/tacker.conf /usr/local/etc/tacker/
# /usr/local/bin/tacker-db-manage --config-file /usr/local/etc/tacker/tacker.conf upgrade head
# cat &lt;&lt;EOF &gt; /lib/systemd/system/tacker-server.service
[Unit]
Description=Tacker Server Service
After=apache2.service

[Service]
User=admin
Group=dcg-bj-01.bj.xx.com
Type=simple
WorkingDirectory=/var/lib/tacker
ExecStart=/usr/local/bin/tacker-server --config-file /etc/tacker/tacker.conf --log-dir /var/log/tacker --log-file /var/log/tacker/tacker-server.log --nouse-syslog
Restart=on-failure
LimitNOFILE=65535
TimeoutStopSec=15

[Install]
WantedBy=multi-user.target
EOF

# systemctl disable tacker-server
# systemctl enable tacker-server
# systemctl start tacker-server

# cd ~/
# git clone https://github.com/openstack/python-tackerclient -b stable/pike
# cd python-tackerclient
# python setup.py install

# cd ~
# git clone https://github.com/openstack/tacker-horizon -b stable/pike
# python setup.py install
# cp tacker_horizon/enabled/* /usr/share/openstack-dashboard/openstack_dashboard/enabled/
# systemctl restart apache2

/*extra console needed for such command execution*/
# python /usr/local/bin/tacker-server \
    --config-file /usr/local/etc/tacker/tacker.conf \
    --log-file /var/log/tacker/tacker.log
</code></pre>

<h1 id="compute-node">compute node</h1>

<h2 id="env-prepare-1">env prepare</h2>

<p>configure nic in /etc/network/interfaces
manually add controller and compute name in /etc/hosts, comment the 127.0.1.1</p>

<h2 id="nova-1">nova</h2>

<pre><code class="language-shell"># apt install nova-compute
copy /etc/nova/nova.conf from controller node and modify the [vnc] as follows:
[vnc]
enabled = True
vncserver_listen = 0.0.0.0
vncserver_proxyclient_address = $my_ip
novncproxy_base_url = http://cloud-cluster-01:6080/vnc_auto.html
</code></pre>

<h2 id="neutron-1">neutron</h2>

<p><strong>for linux bridge</strong></p>

<pre><code class="language-shell"># apt install neutron-linuxbridge-agent
# cat &lt;&lt;EOF &gt; /etc/neutron/plugins/ml2/linuxbridge_agent.ini
[linux_bridge]
physical_interface_mappings = provider:ens192

[vxlan]
enable_vxlan = false
local_ip = 10.61.39.187
l2_population = true

[securitygroup]
enable_security_group = true
firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver
EOF
</code></pre>

<p><strong>for ovs</strong></p>

<pre><code class="language-shell"># apt install neutron-openvswitch-agent
# cat &lt;&lt;EOF &gt; /etc/neutron/plugins/ml2/openvswitch_agent.ini
[DEFAULT]
debug = False
# log_config_append = /etc/neutron/logging.conf

[securitygroup]
enable_security_group = True

[ovs]
bridge_mappings = external:br-ex,provider:br-vlan
datapath_type = netdev
vhostuser_socket_dir = /var/run/openvswitch
ovsdb_interface = vsctl

[agent]
#extensions = sfc,qos
enable_distributed_routing = True
EOF
</code></pre>

<p>** common part</p>

<pre><code class="language-shell"># edit /etc/neutron/neutron.conf
[DEFAULT]
transport_url = rabbit://openstack:xxDCG@cloud-cluster-01

[keystone_authtoken]
auth_uri = http://cloud-cluster-01:5000
auth_url = http://cloud-cluster-01:35357
memcached_servers = cloud-cluster-01:11211
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = neutron
password = xxDCG

# service nova-compute restart
# service neutron-linuxbridge-agent restart
# service neutron-openvswitch-agent restart
</code></pre>


                

                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/post/about-balance/" data-toggle="tooltip" data-placement="top" title="平衡">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                </ul>

                
<div id="disqus-comment"></div>



            </div>
            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/hands-on" title="hands-on">
                            hands-on
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/virtio" title="virtio">
                            virtio
                        </a>
                        
                        
                    </div>
                </section>
                

                
                
                <section>
                    <hr>
                    <h5>FRIENDS</h5>
                    <ul class="list-inline">
                        
                        <li><a target="_blank" href="https://www.jianshu.com/u/92bb7713098d">Blog in jianshu</a></li>
                        
                    </ul>
                </section>
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                   <li>
                       <a href="" rel="alternate" type="application/rss+xml" title="Aaron&#39;s Notes" >
                           <span class="fa-stack fa-lg">
                               <i class="fa fa-circle fa-stack-2x"></i>
                               <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
                   
                    
                    <li>
                        <a href="mailto:youremail@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    

                    

		    
                    
                    <li>
                        <a target="_blank" href="/your%20wechat%20qr%20code%20image">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-wechat fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    <li>
                        <a target="_blank" href="https://github.com/yourgithub">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/yourlinkedinid">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                </ul>
		<p class="copyright text-muted">
                    Copyright &copy; Aaron&#39;s Notes 2019
                    <br>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-136672666-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</body>
</html>
